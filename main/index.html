<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="./manifest.json" />
    <title>Main</title>
    <script src="./platform.web.umd.js"></script>
    <script src="./workspaces.umd.js"></script>
    <script src="./jpm.core.umd.js"></script>
    <script src="./jpm.entitlements.umd.js"></script>
    <script src="./plugin.js"></script>
</head>

<body>
    <h1>Main</h1>
</body>

<!-- <iframe class="border rounded flex-grow-1" src="http://localhost:9100"></iframe> -->

<script>
    // POSSIBLE APPLICATIONS CONFIG:

    const applications = {
        local: [
            {
                name: "SimpleOne",
                type: "window",
                title: "SimpleOne",
                details: {
                    url: "http://localhost:9100/"
                },
                customProperties: {
                    includeInWorkspaces: true
                }
            },
            {
                name: "symphony",
                type: "window",
                title: "symphony",
                details: {
                    url: "https://66494.p.symphony.com/"
                },
                customProperties: {
                    includeInWorkspaces: true
                }
            }
        ]
    }

    // POSSIBLE LAYOUTS CONFIG:

    const layouts = {
        mode: "session",
        local: [
            { "name": "example2", "type": "Workspace", "components": [{ "type": "Workspace", "state": { "config": { "name": "second", "title": "Untitled 1" }, "context": {}, "children": [{ "type": "column", "config": {}, "children": [{ "type": "row", "config": {}, "children": [{ "type": "group", "config": {}, "children": [{ "type": "window", "config": { "appName": "SimpleOne", "title": "asd" } }] }, { "type": "group", "config": {}, "children": [{ "type": "window", "config": { "appName": "SimpleOne" } }] }] }, { "type": "group", "config": {}, "children": [{ "type": "window", "config": { "appName": "SimpleOne" } }] }] }] } }], "metadata": {} },
            { "name": "not-example", "type": "Workspace", "components": [{ "type": "Workspace", "state": { "config": { "name": "second", "title": "Untitled 1" }, "context": {}, "children": [{ "type": "column", "config": {}, "children": [{ "type": "row", "config": {}, "children": [{ "type": "group", "config": {}, "children": [{ "type": "window", "config": { "appName": "SimpleOne" } }] }, { "type": "group", "config": {}, "children": [{ "type": "window", "config": { "appName": "SimpleOne" } }] }] }, { "type": "group", "config": {}, "children": [{ "type": "window", "config": { "appName": "SimpleOne" } }] }] }] } }], "metadata": {} },
            {
                "name": "asd",
                "type": "Workspace",
                "metadata": {},
                "components": [
                    {
                        "type": "Workspace",
                        "state": {
                            "config": {
                                "name": "asd",
                                "title": "Untitled 1"
                            },
                            "context": null,
                            "children": [
                                {
                                    "type": "column",
                                    "config": {},
                                    "children": [
                                        {
                                            "type": "group",
                                            "config": {},
                                            "children": [
                                                {
                                                    "type": "window",
                                                    "config": {
                                                        "appName": "SimpleOne"
                                                    }
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    }
                ]
            }
        ]
    };

    // const plugins = {
    //     definitions: [
    //         {
    //             name: "first-plugin",
    //             config: { test: 42 },
    //             start: (glue, config) => {
    //                 glue.interop.register("asd", () => console.log("42"));
    //             }
    //         }
    //     ]
    // };

    const swPromise = navigator.serviceWorker.register('/service-worker.js');

    const plugins = {
        definitions: [
            {
                name: "notifications",
                start: window.notificationPluginStart,
                config: { sw: swPromise }
            }
        ]
    };

    const config = {
        glue: {
            libraries: [GlueWorkspaces],
            systemLogger: { level: "warn" }, // you can set this to trace for maximum console output,
            notifications: {
                defaultClick: (glue, data) => {
                    glue.appManager.application("SimpleOne").start();
                    console.log(glue.version);
                    console.log(data);
                },
                actionClicks: [
                    { action: "One", handler: (glue, data) => console.log(data) }
                ]
            }
        },
        layouts,
        applications,
        workspaces: {
            src: "http://localhost:9300",
            frameCache: true
        },
        plugins,
        serviceWorker: {
            url: "/service-worker.js"
        },
        environment: {
            region: "EMEA"
        }
    };

    GlueWebPlatform(config)
        .then((data) => {
            window.glue = data.glue;
            // return notificationPluginStart(data.glue, { sw: swPromise });
        })
        .then(() => console.log("done"))
        .catch(console.warn);
</script>

</html>